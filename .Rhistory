arrayType = "IlluminaHumanMethylation450k",
annotationVersion = "ilmn12.hg19",
sexColumn = "sex",
plotGroupVar = "sex",
phenoOrder = Sample_Name;sex;Basename;Sentrix_ID;Sentrix_Position
preprocessingMinfiEwasWater(
phenoFile = "data/preprocessingMinfiEwasWater/pheno_minfiData.csv",
idatFolder = "C:/Users/ruizpint/AppData/Local/Programs/R/R-4.4.1/library/minfiData/extdata/",
nSamples = 5,
SampleID = "Sample_Name",
phenoOrder = "Sample_Name;sex;Basename;Array;Slide",
arrayType = "IlluminaHumanMethylation450k",
annotationVersion = "ilmn12.hg19",
sexColumn = "sex",
plotGroupVar = "sex",
phenoOrder = "Sample_Name;sex;Basename;Sentrix_ID;Sentrix_Position"
)
preprocessingMinfiEwasWater(
phenoFile = "data/preprocessingMinfiEwasWater/pheno_minfiData.csv",
idatFolder = "C:/Users/ruizpint/AppData/Local/Programs/R/R-4.4.1/library/minfiData/extdata/",
nSamples = 5,
SampleID = "Sample_Name",
phenoOrder = "Sample_Name;sex;Basename;Array;Slide",
arrayType = "IlluminaHumanMethylation450k",
annotationVersion = "ilmn12.hg19",
sexColumn = "sex",
plotGroupVar = "sex"
)
# svaEnmix(
#
# )
#
# preprocessingPheno(
#   timeVar = "TreatvControl_Time1_vs_Time2"
# )
# methylationGLM_T1(
#   phenotypes = "Sex",
#   covariates = "Sex,Age.at.collection,Leukocytes,Epithelial.cells,MedicationYesNo",
#   factorVars = "Sex,MedicationYesNo,TreatmentGroup",
#   cpgLimit = 100,
#   nCores = 4,
#   significantCpGPval = 1,
#   interactionTerm = "Age.at.collection"
# )
# methylationGLMM_T1T2(
#   personVar = "Tube_Name",
#   timeVar = "TreatvControl_Time1_vs_Time2",
#   phenotypes = "Sex",
#   covariates = "Age.at.collection,Leukocytes,Epithelial.cells,MedicationYesNo",
#   interactionTerm = "TreatvControl_Time1_vs_Time2",
#   factorVars = "Sex,MedicationYesNo",
#   cpgLimit = 100,
#   nCores = 4,
#   significantInteractionPval = 1
# )
# dnamReport(output = "DNAm_Report.pdf",
#            outputDir = "reports")
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::use_testthat()
usethis::use_testthat()
usethis::use_test()
usethis::use_test()
devtools::document()
BiocCheck::BiocCheck()
R CMD BiocCheck
devtools::document()
startTime <- Sys.time()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
crop = NULL ## Related to https://stat.ethz.ch/pipermail/bioc-devel/2020-April/016656.html
)
library(dnaEPICO)
library(ewastools)
devtools::document()
devtools::document()
devtools::load_all()
devtools::install_loca()
devtools::install_local()
devtools::install_local()
devtools::install_local()
devtools::document()
devtools::build_readme()
BiocCheck::BiocCheck()
rdFiles <- list.files("man", pattern = "\\.Rd$", full.names = TRUE)
for (f in rdFiles) {
raw <- readBin(f, what = "raw", n = file.info(f)$size)
if (any(raw == as.raw(0))) {
message("âŒ NUL byte found in: ", f)
}
}
BiocCheck::BiocCheck()
BiocCheck::BiocCheck(checkDir = "check", debug = TRUE)
tools::showNonASCIIfile("R")
grep(
"analysis-ready phenotype",
list.files("R", full.names = TRUE),
value = TRUE
)
devtools::document()
BiocCheck::BiocCheck()
BiocCheck::BiocCheck()
BiocCheck::BiocCheck()
usethis::use_dev_package(package = "ewastools", type = "Imports", remote = "hhhh5/ewastools")
usethis::use_dev_package(package = "dnaEPICO", type = "Imports", remote = "paulYRP/dnaEPICO")
devtools::document()
devtools::document()
devtools::document()
devtools::document()
BiocCheck::BiocCheck()
devtools::document()
warnings()
warnings()
devtools::document()
devtools::document()
BiocCheck::BiocCheck()
devtools::document()
BiocCheck::BiocCheck()
devtools::document()
git status --ignored
devtools::document()
BiocCheck::BiocCheck()
devtools::document()
BiocCheck::BiocCheck()
devtools::document()
BiocCheck::BiocCheck()
devtools::document()
BiocCheck::BiocCheck()
devtools::document()
BiocCheck::BiocCheck()
BiocCheck::BiocCheck()
devtools::document()
BiocCheck::BiocCheck()
BiocCheck::BiocCheck()
BiocCheck::BiocCheck()
BiocCheck::BiocCheck()
devtools::document()
rcmdcheck::rcmdcheck(
args = c("--no-manual", "--no-vignettes", "--timings"),
build_args = c("--no-manual", "--keep-empty-dirs", "--no-resave-data"),
error_on = "error",
check_dir = "check"
)
library(dnaEPICO)
packageVersion("dnaEPICO")
ls("package:dnaEPICO")
load("rData/preprocessingMinfiEwasWater/metrics/beta_NomFilt_MSetF_Flt_Rxy_Ds_Rc.RData")
beta
library(ENmix)
?estimateCellProp
estimateCellProp(beta,refdata="FlowSorted.Blood.450k",
cellTypes=NULL,nonnegative = TRUE,nProbes=50,
normalize=TRUE,refplot=FALSE)
load("rData/model1/preprocessingMinfiEwasWater/metrics/beta_NomFilt_MSetF_Flt_Rxy_Ds_Rc.RData")
estimateCellProp(beta,refdata="FlowSorted.Blood.EPIC",
cellTypes=NULL,nonnegative = TRUE,nProbes=50,
normalize=TRUE,refplot=FALSE)
devtools::install_github("immunomethylomics/FlowSorted.BloodExtended.EPIC", force = TRUE)
# devtools::install_github("immunomethylomics/FlowSorted.BloodExtended.EPIC", force = TRUE)
library(FlowSorted.BloodExtended.EPIC)
betaENMIX<- rm.cgsuffix(beta)
IDOLOptimizedCpGsBloodv2<- IDOLOptimizedCpGs[which(IDOLOptimizedCpGs%in%rownames(betaENMIX))]
identical(rownames(IDOLOptimizedCpGs.compTable[IDOLOptimizedCpGsBloodv2,]), IDOLOptimizedCpGsBloodv2)
propEPIC <- projectCellType_CP(
betaENMIX[IDOLOptimizedCpGsBloodv2, ],
IDOLOptimizedCpGs.compTable[IDOLOptimizedCpGsBloodv2,],
contrastWBC = NULL, nonnegative = TRUE,
lessThanOne = FALSE
)
head(propEPIC)
# Assuming RGsetTargets is your target data
# And using the IDOL optimized CpGs for Extended blood
counts <- estimateCellCounts2(beta,
compositeCellType = "Blood",
processMethod = "preprocessNoob",
referencePlatform = "IlluminaHumanMethylationEPIC",
referenceset = "FlowSorted.BloodExtended.EPIC")
load("rData/model1/preprocessingMinfiEwasWater/filterObjects/removCrossReactive_MSetF_Flt_Rxy_Ds_Rc.RData")
# Assuming RGsetTargets is your target data
# And using the IDOL optimized CpGs for Extended blood
counts <- estimateCellCounts2(MSetF_Flt_Rxy_Ds_Rc,
compositeCellType = "Blood",
processMethod = "preprocessNoob",
referencePlatform = "IlluminaHumanMethylationEPIC",
referenceset = "FlowSorted.BloodExtended.EPIC")
counts <- estimateCellCounts2(MSetF_Flt_Rxy_Ds_Rc,
compositeCellType = "Blood",
processMethod = "preprocessNoob",
referencePlatform = "IlluminaHumanMethylationEPIC",
referenceset = "FlowSorted.BloodExtended.EPIC")
# Assuming RGsetTargets is your target data
# And using the IDOL optimized CpGs for Extended blood
class(MSetF_Flt_Rxy_Ds_Rc)
load("rData/model1/preprocessingMinfiEwasWater/normObjects/norm_adjustedfunnorm_RGSet.RData")
estimateCellProp(normObj,refdata="FlowSorted.Blood.EPIC",
cellTypes=NULL,nonnegative = TRUE,nProbes=50,
normalize=TRUE,refplot=FALSE)
estimateCellProp(beta,refdata="FlowSorted.Blood.EPIC",
cellTypes=NULL,nonnegative = TRUE,nProbes=50,
normalize=TRUE,refplot=FALSE)
counts <- estimateCellCounts2(normObj,
compositeCellType = "Blood",
processMethod = "preprocessNoob",
referencePlatform = "IlluminaHumanMethylationEPIC",
referenceset = "FlowSorted.BloodExtended.EPIC")
estimateCellProp(beta,refdata="FlowSorted.BloodExtended.EPIC",
cellTypes=NULL,nonnegative = TRUE,nProbes=50,
normalize=TRUE,refplot=FALSE)
counts <- estimateCellCounts2(normObj,
compositeCellType = "Blood",
processMethod = "preprocessNoob",
referencePlatform = "IlluminaHumanMethylationEPIC",
referenceset = "FlowSorted.BloodExtended.EPIC")
class(normObj)
load("rData/model1/preprocessingMinfiEwasWater/objects/RGSet.RData")
class(normObj)
counts <- estimateCellCounts2(RGSet,
compositeCellType = "Blood",
processMethod = "preprocessNoob",
referencePlatform = "IlluminaHumanMethylationEPIC",
referenceset = "FlowSorted.BloodExtended.EPIC")
# devtools::install_github("immunomethylomics/FlowSorted.BloodExtended.EPIC", force = TRUE)
library(FlowSorted.BloodExtended.EPIC)
counts <- estimateCellCounts2(RGSet,
compositeCellType = "Blood",
processMethod = "preprocessNoob",
referencePlatform = "IlluminaHumanMethylationEPIC",
referenceset = "FlowSorted.BloodExtended.EPIC")
library(minfi)
?estimateCellCounts2
?FlowSorted.BloodExtended.EPIC
?estimateCellCounts2
library(ExperimentHub)
# devtools::install_github("immunomethylomics/FlowSorted.BloodExtended.EPIC", force = TRUE)
library(FlowSorted.BloodExtended.EPIC)
library(minfi)
library(ExperimentHub)
FlowSorted.Blood.EPIC <- libraryDataGet('FlowSorted.Blood.EPIC')
RGsetTargets <- FlowSorted.Blood.EPIC[,
FlowSorted.Blood.EPIC$CellType == "MIX"]
sampleNames(RGSet) <- paste(RGSet$CellType,
seq_len(dim(RGSet)[2]), sep = "_")
RGSet
prop_ext <- estimateCellCounts2(RGSet,
compositeCellType = "BloodExtended",
processMethod = "preprocessNoob",
probeSelect = "IDOL",
cellTypes = c(
"Bas", "Bmem", "Bnv",
"CD4mem", "CD4nv",
"CD8mem", "CD8nv", "Eos",
"Mono", "Neu", "NK", "Treg"),
CustomCpGs =if(RGsetTargets@annotation[1]=="IlluminaHumanMethylationEPIC"){
IDOLOptimizedCpGsBloodExtended}else{IDOLOptimizedCpGsBloodExtended450k})
# devtools::install_github("immunomethylomics/FlowSorted.BloodExtended.EPIC", force = TRUE)
library(FlowSorted.BloodExtended.EPIC)
library(minfi)
library(ExperimentHub)
FlowSorted.Blood.EPIC <- libraryDataGet('FlowSorted.Blood.EPIC')
prop_ext <- estimateCellCounts2(RGSet,
compositeCellType = "BloodExtended",
processMethod = "preprocessNoob",
probeSelect = "IDOL",
cellTypes = c(
"Bas", "Bmem", "Bnv",
"CD4mem", "CD4nv",
"CD8mem", "CD8nv", "Eos",
"Mono", "Neu", "NK", "Treg"),
CustomCpGs =if(RGsetTargets@annotation[1]=="IlluminaHumanMethylationEPIC"){
IDOLOptimizedCpGsBloodExtended}else{IDOLOptimizedCpGsBloodExtended450k})
counts <- estimateCellCounts2(
RGSet,
compositeCellType = "BloodExtended",
processMethod = "preprocessNoob",
probeSelect = "IDOL",
cellTypes = c(
"Bas", "Bmem", "Bnv",
"CD4mem", "CD4nv",
"CD8mem", "CD8nv",
"Eos", "Mono", "Neu",
"NK", "Treg"
),
referencePlatform = "IlluminaHumanMethylationEPIC"
)
prop_ext <- estimateCellCounts2(RGSet,
compositeCellType = "BloodExtended",
processMethod = "preprocessNoob",
probeSelect = "IDOL",
cellTypes = c(
"Bas", "Bmem", "Bnv",
"CD4mem", "CD4nv",
"CD8mem", "CD8nv", "Eos",
"Mono", "Neu", "NK", "Treg"),
CustomCpGs =if(RGsetTargets@annotation[1]=="IlluminaHumanMethylationEPIC"){
IDOLOptimizedCpGsBloodExtended}else{IDOLOptimizedCpGsBloodExtended450k})
library(FlowSorted.BloodExtended.EPIC)
data("FlowSorted.BloodExtended.EPIC")
prop_ext <- estimateCellCounts2(RGSet,
compositeCellType = "BloodExtended",
processMethod = "preprocessNoob",
probeSelect = "IDOL",
cellTypes = c(
"Bas", "Bmem", "Bnv",
"CD4mem", "CD4nv",
"CD8mem", "CD8nv", "Eos",
"Mono", "Neu", "NK", "Treg"),
CustomCpGs =if(RGsetTargets@annotation[1]=="IlluminaHumanMethylationEPIC"){
IDOLOptimizedCpGsBloodExtended}else{IDOLOptimizedCpGsBloodExtended450k})
FlowSorted.Blood.EPIC <- libraryDataGet('FlowSorted.Blood.EPIC')
prop_ext <- estimateCellCounts2(RGSet,
compositeCellType = "BloodExtended",
processMethod = "preprocessNoob",
probeSelect = "IDOL",
cellTypes = c(
"Bas", "Bmem", "Bnv",
"CD4mem", "CD4nv",
"CD8mem", "CD8nv", "Eos",
"Mono", "Neu", "NK", "Treg"),
CustomCpGs =if(RGsetTargets@annotation[1]=="IlluminaHumanMethylationEPIC"){
IDOLOptimizedCpGsBloodExtended}else{IDOLOptimizedCpGsBloodExtended450k})
FlowSorted.BloodExtended.EPIC <- libraryDataGet('FlowSorted.BloodExtended.EPIC')
# FlowSorted.BloodExtended.EPIC <- libraryDataGet('FlowSorted.BloodExtended.EPIC')
prop_ext <- estimateCellCounts2(RGSet,
compositeCellType = "BloodExtended",
processMethod = "preprocessNoob",
probeSelect = "IDOL",
cellTypes = c(
"Bas", "Bmem", "Bnv",
"CD4mem", "CD4nv",
"CD8mem", "CD8nv", "Eos",
"Mono", "Neu", "NK", "Treg"),
CustomCpGs =if(RGsetTargets@annotation[1]=="IlluminaHumanMethylationEPIC"){
IDOLOptimizedCpGsBloodExtended}else{IDOLOptimizedCpGsBloodExtended450k})
# FlowSorted.BloodExtended.EPIC <- libraryDataGet('FlowSorted.BloodExtended.EPIC')
?estimateCellCounts.wateRmelon
# devtools::install_github("immunomethylomics/FlowSorted.BloodExtended.EPIC", force = TRUE)
library(FlowSorted.BloodExtended.EPIC)
library(minfi)
library(wateRmelon)
estimateCellCounts.wmln(
MSetF_Flt_Rxy_Ds_Rc,
referencePlatform = "IlluminaHumanMethylationEPIC",
mn = NULL,
un = NULL,
bn = NULL,
perc = 1,
compositeCellType = "Blood",
probeSelect = "auto",
cellTypes = c("CD8T","CD4T","NK","Bcell","Mono","Gran"),
returnAll = FALSE,
meanPlot = FALSE,
verbose=TRUE)
load("rData/preprocessingMinfiEwasWater/metrics/beta_NomFilt_MSetF_Flt_Rxy_Ds_Rc.RData")
estimateCellCounts.wmln(
beta
,
referencePlatform = "IlluminaHumanMethylationEPIC",
mn = NULL,
un = NULL,
bn = NULL,
perc = 1,
compositeCellType = "Blood",
probeSelect = "auto",
cellTypes = c("CD8T","CD4T","NK","Bcell","Mono","Gran"),
returnAll = FALSE,
meanPlot = FALSE,
verbose=TRUE)
load("rData/model1/preprocessingMinfiEwasWater/objects/RGSet.RData")
startTime <- Sys.time()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
crop = NULL ## Related to https://stat.ethz.ch/pipermail/bioc-devel/2020-April/016656.html
)
# Temporary directory
tmpDir  <- file.path(tempdir(), "dnaEPICO_Test")
dir.create(tmpDir, showWarnings = FALSE, recursive = TRUE)
preprocDir <- file.path(tmpDir, "data", "preprocessingMinfiEwasWater")
dir.create(preprocDir, showWarnings = FALSE, recursive = TRUE)
# Register automatic cleanup when the vignette exits
on.exit(unlink(tmpDir, recursive = TRUE, force = TRUE), add = TRUE)
tmpDir
# Locate minfiData extdata directory
baseDir_minfi <- system.file("extdata", package = "minfiData")
# Find all IDAT files
idatFiles <- list.files(
baseDir_minfi,
pattern = "\\.idat$",
recursive = TRUE,
full.names = TRUE
)
length(idatFiles)
# Create IDAT directory
idatDir <- file.path(preprocDir, "idats")
dir.create(idatDir, showWarnings = FALSE, recursive = TRUE)
# Copy IDATs into idatDir
file.copy(idatFiles, idatDir, overwrite = TRUE)
length(list.files(idatDir, pattern = "\\.idat$"))
# Locate dnaEPICO extdata directory
baseDir_dnaEPICO <- system.file("extdata", package = "dnaEPICO")
# Source cross-reactive probe file
crossReactiveSrc <- file.path(baseDir_dnaEPICO, "12864_2024_10027_MOESM8_ESM.csv")
# Destination path inside tmpDir/data/preprocessingMinfiEwasWater/
crossReactivePath <- file.path(preprocDir, "12864_2024_10027_MOESM8_ESM.csv")
# Copy into the target folder
file.copy(crossReactiveSrc, crossReactivePath, overwrite = TRUE)
file.exists(crossReactivePath)
# Read SampleSheet from minfiData
targets <- read.csv(
file.path(baseDir_minfi, "SampleSheet.csv"),
stringsAsFactors = FALSE,
skip = 7
)
# Create Basename column
targets$Basename <- paste0(
targets$Sentrix_ID,
"_",
targets$Sentrix_Position
)
# Create Timepoint column
targets$Timepoint <- 1
# Write phenotype file
samplePath <- file.path(preprocDir, "sample_minfi.csv")
write.csv(targets, samplePath, row.names = FALSE)
file.exists(samplePath)
preprocessingMinfiEwasWater(
phenoFile = samplePath,
idatFolder = file.path(preprocDir, "idats"),
nSamples = NA,
SampleID = "Sample_Name",
phenoOrder = "Sample_Name;sex;Basename;Sentrix_ID;Sentrix_Position",
arrayType = "IlluminaHumanMethylation450k",
annotationVersion = "ilmn12.hg19",
sexColumn = "sex",
plotGroupVar = "sex",
tiffWidth = 2000,
tiffHeight = 1000,
tiffRes = 150,
qcCutoff = 10.5,
detPtype = "m+u",
detPThreshold = 0.05,
funnormSeed = 123,
normMethods = "adjustedfunnorm",
pvalThreshold = 0.01,
chrToRemove = "chrX,chrY",
snpsToRemove = "SBE,CpG",
mafThreshold = 0.1,
outputLogs = file.path(tmpDir, "logs"),
baseDataFolder = file.path(tmpDir, "rData"),
figureBaseDir = file.path(tmpDir, "figures"),
lcRef = "FlowSorted.Blood.450k",
crossReactivePath = file.path(preprocDir, "12864_2024_10027_MOESM8_ESM.csv"),
lcPhenoDir = preprocDir
)
preprocessingMinfiEwasWater(
phenoFile = samplePath,
idatFolder = file.path(preprocDir, "idats"),
nSamples = NA,
SampleID = "Sample_Name",
phenoOrder = "Sample_Name;sex;Basename;Sentrix_ID;Sentrix_Position",
arrayType = "IlluminaHumanMethylation450k",
annotationVersion = "ilmn12.hg19",
sexColumn = "sex",
plotGroupVar = "sex",
tiffWidth = 2000,
tiffHeight = 1000,
tiffRes = 150,
qcCutoff = 10.5,
detPtype = "m+u",
detPThreshold = 0.05,
funnormSeed = 123,
normMethods = "adjustedfunnorm",
pvalThreshold = 0.01,
chrToRemove = "chrX,chrY",
snpsToRemove = "SBE,CpG",
mafThreshold = 0.1,
outputLogs = file.path(tmpDir, "logs"),
baseDataFolder = file.path(tmpDir, "rData"),
figureBaseDir = file.path(tmpDir, "figures"),
lcRef = "FlowSorted.Blood.450k",
crossReactivePath = file.path(preprocDir, "12864_2024_10027_MOESM8_ESM.csv"),
lcPhenoDir = preprocDir
)
devtools::document
BiocCheck::BiocCheck()
pkgdown::deploy_to_branch()
devtools::document()
devtools::document()
BiocCheck::BiocCheck()
devtools::build_readme()
devtools::document()
print(citation('dnaEPICO'), bibtex = TRUE)
print(citation('dnaEPICO'), bibtex = TRUE)
devtools::build_readme()
devtools::document()
devtools::build_readme()
devtools::document()
pkgdown::deploy_to_branch()
pkgdown::deploy_to_branch()
devtools::document()
pkgdown::deploy_to_branch()
devtools::document()
pkgdown::deploy_to_branch()
devtools::document()
devtools::document()
pkgdown::deploy_to_branch()
devtools::document()
pkgdown::deploy_to_branch()
BiocCheck::BiocCheck()
