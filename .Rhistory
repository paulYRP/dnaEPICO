GS.idtype = "SYMBOL",
minsize = 1,
maxsize = 1e6
)
resGlmStrong
# pick one candidate gene
strongGene <- candidateGL$Candidate[1]
# pick one CpG belonging to it
strongCpG <- fullAnnot %>%
filter(UCSC_RefGene_Name == strongGene) %>%
pull(Name) %>%
.[1]
# force an extreme p-value
cpgPvalStrong <- cpgPval
cpgPvalStrong[strongCpG] <- 1e-30
resGlmStrong <- methylglm(
cpg.pval = cpgPvalStrong,
FullAnnot = fullAnnot,
GS.list = candidateGL,
GS.idtype = "SYMBOL",
minsize = 1,
maxsize = 1e6
)
resGlmStrong
knitr::opts_chunk$set(echo = T)
knitr::opts_chunk$set(warning = F)
knitr::opts_chunk$set(message = F)
knitr::opts_chunk$set(cache = F)
# Install and load required packages
instalload <- function(cran = NULL, bioc = NULL) {
pkgs_cran <- cran[!(cran %in% installed.packages()[, "Package"])]
if (length(pkgs_cran) > 0) {
install.packages(pkgs_cran, dependencies = T)
}
if (!requireNamespace("BiocManager", quietly = T))
install.packages("BiocManager")
pkgs_bioc <- bioc[!(bioc %in% installed.packages()[, "Package"])]
if (length(pkgs_bioc) > 0) {
BiocManager::install(pkgs_bioc, ask = F)
}
pkgs <- c(cran, bioc)
invisible(lapply(pkgs, require, character.only = T))
cat("Packages are installed and loaded successfully.\n")
}
# CRAN & Bioconductor packages
cran <- c("rstudioapi", "memoise", "knitr", "stringr", "emmeans", "readxl", "VIM", "lme4",
"msigdbr", "ggplot2", "dplyr", "glm2", "e1071", "Amelia", "enrichR", "xtable",
"naniar", "misty", "mvnmle", "RColorBrewer", "miceRanger", "mice", "ggmice",
"genomicper", "missForest", "lmerTest", "MASS", "openxlsx", "reshape2", "tidyr")
bioc <- c("minfi", "IlluminaHumanMethylationEPICv2anno.20a1.hg38", "clusterProfiler",
"IlluminaHumanMethylationEPICv2manifest", "limma", "enrichplot", "ALL",
"AnnotationDbi", "org.Hs.eg.db", "TxDb.Hsapiens.UCSC.hg38.knownGene",
"hgu95av2.db", "Biobase", "annotate", "genefilter", "GOstats", "RColorBrewer",
"Rgraphviz", "GO.db", "genefilter", "GOstats", "methylGSA")
instalload(cran, bioc)
# Read txt
cpgs <- readLines("data/enrichmentAnalysis/cpgs.txt")
length(cpgs)
head(cpgs, 20)
# Extract CpG IDs
cpgs <- sub("(cg[0-9]{8}).*", "\\1", cpgs)
length(cpgs)
head(cpgs, 20)
# Get annotation
anno <- getAnnotation(IlluminaHumanMethylationEPICv2anno.20a1.hg38)
# Remove suffixes
baseIDs  <- gsub("_[A-Za-z0-9]+$", "", anno$Name)
# Subset for CpGs
cpgsGene <- anno[match(cpgs, baseIDs), c("Name","UCSC_RefGene_Name")]
cpgsGene
# Extract the genes
genes <- cpgsGene %>%
as_tibble() %>%
separate_rows(UCSC_RefGene_Name, sep = ";") %>%
filter(UCSC_RefGene_Name != "") %>%
distinct(UCSC_RefGene_Name) %>%
arrange(UCSC_RefGene_Name) %>%
pull(UCSC_RefGene_Name)
head(genes)
length(genes)
# writeLines(genes, "data/enrichmentAnalysis/genes.txt")
# Output from HPC
annotatedGLM3 <- read.csv("data/methylationGLM_T1T2/annotatedGLM3.csv")
colnames(annotatedGLM3)
# Eextracting the significant CpGs associated to model 3, pValue from Group*Timepoint
cpgsM3 <- annotatedGLM3 %>%
filter(Model3 < 0.05) %>%
arrange(Model3)
cpgsM3
# Extract the genes
genesM3 <- cpgsM3 %>%
as_tibble() %>%
separate_rows(UCSC_RefGene_Name, sep = ";") %>%
filter(UCSC_RefGene_Name != "") %>%
distinct(UCSC_RefGene_Name) %>%
arrange(UCSC_RefGene_Name) %>%
pull(UCSC_RefGene_Name)
head(genesM3)
length(genesM3)
# Read genes txt
cpgG <- read.csv("data/enrichmentAnalysis/cpgsGene.csv")
head(cpgG, 20)
# Build CpG p-value named vector
cpgPval <- cpgsM3$Model3
names(cpgPval) <- cpgsM3$IlmnID
head(cpgPval)
# Gene mapping cpgsM3
map <- cpgsM3 %>%
dplyr::select(IlmnID, UCSC_RefGene_Name)
fullAnnot <- methylGSA::prepareAnnot(map, geneidtype = "SYMBOL")
fullAnnot
# List candidate genes set (12)
candidateGL <- list(Candidate = genes)
candidateGL
# methylglm
resGlm <- methylglm(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
GS.list = candidateGL,
GS.idtype = "SYMBOL",
GS.type = "KEGG",
minsize = 1,
maxsize = 1e6
)
resGlm
# methylRRA
resRra <- methylRRA(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
method = "ORA",
sig.cut = 0.05,
GS.list = candidateGL,
GS.idtype = "SYMBOL",
GS.type = "KEGG",
minsize = 1,
maxsize = 1e6
)
resRra
# Random gene set comparison
set.seed(123)
nPerm <- 50
# Extract the genes
universe <- fullAnnot %>%
as_tibble() %>%
separate_rows(UCSC_RefGene_Name, sep = ";") %>%
filter(UCSC_RefGene_Name != "") %>%
distinct(UCSC_RefGene_Name) %>%
arrange(UCSC_RefGene_Name) %>%
pull(UCSC_RefGene_Name)
# methylglm
n <- length(candidateGL)
randP <- numeric(nPerm)
for (i in seq_len(nPerm)) {
randGenes <- sample(universe, n, replace = FALSE)
tmp <- methylglm(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
GS.list = list(Random = randGenes),
GS.idtype = "SYMBOL",
minsize = 1,
maxsize = 1e6,
parallel = TRUE
)
resGlm <-
randP[i] <- tmp$pvalue[tmp$ID == "Random"]
}
obsP <- resGlm$pvalue[resGlm$ID == "Candidate"]
# methylglm
resGlm <- methylglm(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
GS.list = candidateGL,
GS.idtype = "SYMBOL",
GS.type = "KEGG",
minsize = 1,
maxsize = 1e6
)
resGlm
# methylglm
resGlm <- methylglm(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
GS.list = candidateGL,
GS.idtype = "SYMBOL",
GS.type = "GO",
minsize = 1,
maxsize = 1e6
)
resGlm
# methylglm
resGlm <- methylglm(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
GS.list = candidateGL,
GS.idtype = "SYMBOL",
GS.type = "KEGG",
minsize = 1,
maxsize = 1e6
)
resGlm
# Random gene set comparison
set.seed(123)
nPerm <- 50
# Extract the genes
universe <- fullAnnot %>%
as_tibble() %>%
separate_rows(UCSC_RefGene_Name, sep = ";") %>%
filter(UCSC_RefGene_Name != "") %>%
distinct(UCSC_RefGene_Name) %>%
arrange(UCSC_RefGene_Name) %>%
pull(UCSC_RefGene_Name)
# methylglm
n <- length(candidateGL$Candidate)
randP <- numeric(nPerm)
for (i in seq_len(nPerm)) {
randGenes <- sample(universe, n, replace = FALSE)
tmp <- methylglm(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
GS.list = list(Random = randGenes),
GS.idtype = "SYMBOL",
minsize = 1,
maxsize = 1e6,
parallel = TRUE
)
randP[i] <- tmp$pvalue[tmp$ID == "Random"]
}
# Random gene set comparison
set.seed(123)
nPerm <- 2
# Extract the genes
universe <- fullAnnot %>%
as_tibble() %>%
separate_rows(UCSC_RefGene_Name, sep = ";") %>%
filter(UCSC_RefGene_Name != "") %>%
distinct(UCSC_RefGene_Name) %>%
arrange(UCSC_RefGene_Name) %>%
pull(UCSC_RefGene_Name)
# methylglm
n <- length(candidateGL$Candidate)
randP <- numeric(nPerm)
for (i in seq_len(nPerm)) {
randGenes <- sample(universe, n, replace = FALSE)
tmp <- methylglm(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
GS.list = list(Random = randGenes),
GS.idtype = "SYMBOL",
minsize = 1,
maxsize = 1e6,
parallel = TRUE
)
randP[i] <- tmp$pvalue[tmp$ID == "Random"]
}
obsP <- resGlm$pvalue[resGlm$ID == "Candidate"]
empiricalP <- mean(randP <= obsP, na.rm = TRUE)
cat("Observed p-value (methylglm):", obsP, "\n")
cat("Empirical p-value:", empiricalP, "\n")
# methylRRA
for (i in seq_len(nPerm)) {
randGenes <- sample(universe, n, replace = FALSE)
tmp <- methylRRA(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
method = "ORA",
sig.cut = 0.05,
GS.list = list(Random = randGenes),
GS.idtype = "SYMBOL",
minsize = 1,
maxsize = 1e6
)
randP[i] <- tmp$pvalue[tmp$ID == "Random"]
}
obsP <- resRra$pvalue[resRra$ID == "Candidate"]
empiricalP <- mean(randP <= obsP, na.rm = TRUE)
cat("Observed p-value (methylRRA):", obsP, "\n")
cat("Empirical p-value:", empiricalP, "\n")
# methylglm
resGlm <- methylglm(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
GS.list = candidateGL,
GS.idtype = "SYMBOL",
GS.type = "KEGG",
minsize = 1,
maxsize = 500
)
resGlm
# methylglm
resGlm <- methylglm(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
GS.list = candidateGL,
GS.idtype = "SYMBOL",
GS.type = "KEGG",
minsize = 1,
maxsize = 1e6
)
resGlm
# methylRRA
resRra <- methylRRA(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
method = "ORA",
sig.cut = 1,
GS.list = candidateGL,
GS.idtype = "SYMBOL",
GS.type = "KEGG",
minsize = 1,
maxsize = 1e6
)
# methylRRA
resRra <- methylRRA(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
method = "ORA",
sig.cut = 0.9,
GS.list = candidateGL,
GS.idtype = "SYMBOL",
GS.type = "KEGG",
minsize = 1,
maxsize = 1e6
)
resRra
# methylRRA
resRra <- methylRRA(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
method = "ORA",
sig.cut = 1,
GS.list = candidateGL,
GS.idtype = "SYMBOL",
GS.type = "KEGG",
minsize = 1,
maxsize = 1e6
)
# methylRRA
resRra <- methylRRA(
cpg.pval = cpgPval,
FullAnnot = fullAnnot,
method = "ORA",
sig.cut = 0.05,
GS.list = candidateGL,
GS.idtype = "SYMBOL",
GS.type = "KEGG",
minsize = 1,
maxsize = 1e6
)
resRra
View(resGlm)
knitr::opts_chunk$set(echo = T)
knitr::opts_chunk$set(warning = F)
knitr::opts_chunk$set(message = F)
knitr::opts_chunk$set(cache = F)
library(ewastools)
# Install and load required packages
instalload <- function(cran = NULL, bioc = NULL) {
pkgs_cran <- cran[!(cran %in% installed.packages()[, "Package"])]
if (length(pkgs_cran) > 0) {
install.packages(pkgs_cran, dependencies = T)
}
if (!requireNamespace("BiocManager", quietly = T))
install.packages("BiocManager")
pkgs_bioc <- bioc[!(bioc %in% installed.packages()[, "Package"])]
if (length(pkgs_bioc) > 0) {
BiocManager::install(pkgs_bioc, ask = F)
}
pkgs <- c(cran, bioc)
invisible(lapply(pkgs, require, character.only = T))
cat("Packages are installed and loaded successfully.\n")
}
# CRAN & Bioconductor packages
cran <- c("rstudioapi", "memoise", "knitr", "RColorBrewer", "stringr", "parallel",
"gridExtra", "ggplot2", "dplyr", "glm2", "e1071", "Amelia", "tidyr", "ggrepel",
"naniar", "misty", "mvnmle", "VIM", "miceRanger", "mice", "ggmice", "car",
"missForest", "skimr", "MASS", "beeswarm", "reshape2", "readxl", "plotly",
"htmlwidgets")
bioc <- c("minfi", "IlluminaHumanMethylationEPICv2anno.20a1.hg38",
"IlluminaHumanMethylationEPICv2manifest", "limma",
"Gviz", "ENmix", "wateRmelon")
instalload(cran)
install.packages("tinytex")
install.packages("tinytex")
install.packages("tinytex")
knitr::opts_chunk$set(echo = T)
knitr::opts_chunk$set(warning = F)
knitr::opts_chunk$set(message = F)
knitr::opts_chunk$set(cache = F)
library(ewastools)
# Install and load required packages
instalload <- function(cran = NULL, bioc = NULL) {
pkgs_cran <- cran[!(cran %in% installed.packages()[, "Package"])]
if (length(pkgs_cran) > 0) {
install.packages(pkgs_cran, dependencies = T)
}
if (!requireNamespace("BiocManager", quietly = T))
install.packages("BiocManager")
pkgs_bioc <- bioc[!(bioc %in% installed.packages()[, "Package"])]
if (length(pkgs_bioc) > 0) {
BiocManager::install(pkgs_bioc, ask = F)
}
pkgs <- c(cran, bioc)
invisible(lapply(pkgs, require, character.only = T))
cat("Packages are installed and loaded successfully.\n")
}
# CRAN & Bioconductor packages
cran <- c("rstudioapi", "memoise", "knitr", "RColorBrewer", "stringr", "parallel",
"gridExtra", "ggplot2", "dplyr", "glm2", "e1071", "Amelia", "tidyr", "ggrepel",
"naniar", "misty", "mvnmle", "VIM", "miceRanger", "mice", "ggmice", "car",
"missForest", "skimr", "MASS", "beeswarm", "reshape2", "readxl", "plotly",
"htmlwidgets")
bioc <- c("minfi", "IlluminaHumanMethylationEPICv2anno.20a1.hg38",
"IlluminaHumanMethylationEPICv2manifest", "limma",
"Gviz", "ENmix", "wateRmelon")
instalload(cran)
library(tinytex)
tinytex::tlmgr_install("setspace")
tinytex::tlmgr_search("setspace")
tinytex::tlmgr_install("latex-tools")
tinytex::reinstall_tinytex()
tinytex::tlmgr_install(c(
"setspace",
"textcase",
"lasy",
"amsfonts",
"amsmath",
"latexsym",
"graphics",
"graphics-def",
"tools",
"cm"
))
tinytex::tlmgr_install(c(
"endnotes.sty"
))
tinytex::tlmgr_install(c(
"endnotes"
))
tinytex::tlmgr_install(c(
"moreverb"
))
tinytex::tlmgr_install(c(
"courier",
"helvet",
"times",
"moreverb",
"url",
"hyperref",
"graphics",
"booktabs"
))
tinytex::tlmgr_install("crop")
tinytex::tlmgr_install("datetime")
tinytex::tlmgr_install("fmtcount")
tinytex::tlmgr_install(c("crop", "datetime", "fmtcount", "etoolbox", "xstring"))
tinytex::tlmgr_install(c("grfext", "epstopdf-pkg", "pdftexcmds", "kvoptions"))
tinytex::tlmgr_install("parskip")
pdflatex frontiers.tex
folderPath <- "C:/Users/ruizpint/Downloads/Frontiers_LaTeX_Templates"
fileList <- list.files(folderPath, recursive = TRUE, full.names = TRUE)
fileList
fileList
devtools::document()
BiocCheck::BiocCheck()
BiocCheck::BiocCheck()
devtools::clean_vignettes()
devtools::document()
BiocCheck::BiocCheck()
devtools::document()
BiocCheck::BiocCheck()
BiocCheck::BiocCheck()
BiocCheck::BiocCheck()
devtools::document()
BiocCheck::BiocCheck()
devtools::document()
BiocCheck::BiocCheck()
devtools::document()
BiocCheck::BiocCheck()
pkgdown::deploy_to_branch()
---
title: "The dnaEPICO User's Guide"
devtools::document()
devtools::build_readme()
devtools::build_readme()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
rcmdcheck::rcmdcheck(
args = c("--no-manual", "--no-vignettes", "--timings"),
build_args = c("--no-manual", "--keep-empty-dirs", "--no-resave-data"),
error_on = "error",
check_dir = "check"
)
rcmdcheck::rcmdcheck(
args = c("--no-manual", "--no-vignettes", "--timings"),
build_args = c("--no-manual", "--keep-empty-dirs", "--no-resave-data"),
error_on = "error",
check_dir = "check"
)
BiocCheck::BiocCheck()
tools::checkRd(".")
tools::checkRd("man")
startTime <- Sys.time()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
crop = NULL ## Related to https://stat.ethz.ch/pipermail/bioc-devel/2020-April/016656.html
)
rd_files <- list.files("man", full.names = TRUE)
tools::checkRd(rd_files)
